<!DOCTYPE html>
<html>
<head>
    <title>测试前端显示逻辑</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .positive {
            color: green;
        }
        .negative {
            color: red;
        }
    </style>
</head>
<body>
    <h1>测试前端显示逻辑</h1>
    <table id="coinsTable">
        <thead>
            <tr>
                <th>币种</th>
                <th>当前持仓量</th>
                <th>5m变化</th>
                <th>15m变化</th>
                <th>30m变化</th>
                <th>1h变化</th>
                <th>2h变化</th>
                <th>4h变化</th>
                <th>6h变化</th>
                <th>12h变化</th>
            </tr>
        </thead>
        <tbody id="coinsTableBody">
        </tbody>
    </table>

    <script>
        // 模拟从API获取的数据
        const testData = {
          "success": true,
          "data": [
            {
              "symbol": "BTCUSDT",
              "current_open_interest": 372590.0,
              "current_open_interest_formatted": "372.59k",
              "current_open_interest_value": 25000000.0,
              "current_open_interest_value_formatted": "25.00m",
              "current_price": 66.88,
              "current_price_formatted": "66.88",
              "price_change": null,
              "price_change_percent": null,
              "price_change_formatted": "N/A",
              "changes": [
                {
                  "interval": "1h",
                  "ratio": 0.31,
                  "value_ratio": 0.81,
                  "open_interest": 372590.0,
                  "open_interest_formatted": "372.59k",
                  "open_interest_value": 25000000.0,
                  "open_interest_value_formatted": "25.00m",
                  "price_change": null,
                  "price_change_percent": null,
                  "price_change_formatted": "N/A",
                  "current_price": null,
                  "past_price": 66.77,
                  "current_price_formatted": "N/A",
                  "past_price_formatted": "66.77"
                },
                {
                  "interval": "5m",
                  "ratio": 0.06,
                  "value_ratio": 0.4,
                  "open_interest": 372590.0,
                  "open_interest_formatted": "372.59k",
                  "open_interest_value": 25000000.0,
                  "open_interest_value_formatted": "25.00m",
                  "price_change": null,
                  "price_change_percent": null,
                  "price_change_formatted": "N/A",
                  "current_price": null,
                  "past_price": 66.87,
                  "current_price_formatted": "N/A",
                  "past_price_formatted": "66.87"
                }
              ]
            }
          ]
        };

        // 渲染币种表格
        function renderCoinsTable(coinsData) {
          const tableBody = document.getElementById("coinsTableBody");
          tableBody.innerHTML = "";

          coinsData.forEach((coin) => {
            const row = document.createElement("tr");

            // 币种
            const symbolCell = document.createElement("td");
            symbolCell.textContent = coin.symbol;
            row.appendChild(symbolCell);

            // 当前持仓量
            const currentCell = document.createElement("td");
            currentCell.textContent = coin.current_open_interest
              ? formatNumber(coin.current_open_interest)
              : "N/A";
            row.appendChild(currentCell);

            // 各时间间隔的变化比例
            const intervals = ["5m", "15m", "30m", "1h", "2h", "4h", "6h", "12h"];

            intervals.forEach((interval) => {
              if (interval === "5m") return; // 跳过5m自身

              const cell = document.createElement("td");
              // 从数组中查找对应时间间隔的数据
              const change = coin.changes.find(item => item.interval === interval);

              if (change && change.ratio !== null && change.ratio !== undefined) {
                cell.textContent = change.ratio.toFixed(2) + "%";
                if (change.ratio > 0) {
                  cell.classList.add("positive");
                } else if (change.ratio < 0) {
                  cell.classList.add("negative");
                }
              } else {
                cell.textContent = "N/A";
              }

              row.appendChild(cell);
            });

            tableBody.appendChild(row);
          });
        }

        // 格式化数字
        function formatNumber(num) {
          if (num >= 1000000) {
            return (num / 1000000).toFixed(2) + "M";
          } else if (num >= 1000) {
            return (num / 1000).toFixed(2) + "K";
          } else {
            return num.toFixed(2);
          }
        }

        // 页面加载完成后渲染数据
        document.addEventListener('DOMContentLoaded', function() {
            renderCoinsTable(testData.data);
        });
    </script>
</body>
</html>